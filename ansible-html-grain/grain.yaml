
name: ansible_html_grain
inputs:
  bucket_name: string
  torque_output: string
outputs:
  html_link: string

steps:
  - name: Create Playbook
    run: |
      mkdir -p ansible_html_grain
      cat <<'EOF' > ansible_html_grain/playbook.yml
      ---
      - name: Generate HTML file with static values
        hosts: localhost
        tasks:
          - name: Ensure destination directory exists
            file:
              path: "/terraform-s3-bucket/finaloutput"
              state: directory
              mode: '0755'

          - name: Create HTML file with static values
            copy:
              dest: "/terraform-s3-bucket/finaloutput/index.html"
              content: |
                <!DOCTYPE html>
                <html>
                <head><title>Deployment Details</title></head>
                <body>
                  <h1>Bucket: {{ bucket_name }}</h1>
                  <p>Torque Output: {{ torque_output }}</p>
                </body>
                </html>
      EOF

  - name: Run Playbook
    run: |
      cd ansible_html_grain
      ansible-playbook --inventory {{ workspace }}/inventory.yaml playbook.yml --extra-vars "@{{ workspace }}/inputs.json"

  - name: Set Output
    run: |
      echo "html_link=https://github.com/namraotkar/terraform-s3-bucket/blob/main/ansible-html-grain/index.html" >> $GRAIN_OUTPUTS_FILE
