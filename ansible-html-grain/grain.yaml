
name: ansible_html_grain
inputs:
  bucket_name: string
  torque_output: string
outputs:
  html_link: string

steps:
  - name: Run Playbook
    run: |
      cd {{ workspace }}/ansible-html-grain
      ansible-playbook --inventory {{ workspace }}/inventory.yaml playbook.yml --extra-vars "@{{ workspace }}/inputs.json"

  - name: Commit HTML to GitHub
    run: |
      cd {{ workspace }}
      git config --global user.email "torque-bot@example.com"
      git config --global user.name "Torque Bot"
      cp /terraform-s3-bucket/finaloutput/index.html ansible-html-grain/index.html
      git add ansible-html-grain/index.html
      git commit -m "Add generated HTML file"
      git push origin main

  - name: Set Output
    run: |
      echo "html_link=https://github.com/namraotkar/terraform-s3-bucket/blob/main/ansible-html-grain/index.html" >> $GRAIN_OUTPUTS_FILE
