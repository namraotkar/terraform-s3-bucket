---
- name: Generate HTML file with Grain Outputs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Ensure output directory exists
      file:
        path: /home/root/tmp-storage/output
        state: directory

    - name: Create HTML file with URLs
      copy:
        dest: /home/root/tmp-storage/output/index.html
        content: |
          <!DOCTYPE html>
          <html>
          <head>
              <title>Grain Outputs</title>
          </head>
          <body>
              <h1>Generated Outputs</h1>
              <p><strong>S3 Bucket:</strong> my-s3-bucket</p>
              <p><strong>Torque Output:</strong> Deployment successful</p>
          </body>
          </html>

    - name: Copy file to repo folder
      command: cp /home/root/tmp-storage/output/index.html /home/root/tmp-storage/acc2899/workspace/repository/terraform-s3-bucket/finaloutput/index.html

    - name: Commit and push to GitHub
      shell: |
        cd /home/root/tmp-storage/acc2899/workspace/repository
        git config --global user.email "your-email@example.com"
        git config --global user.name "Torque Automation"
        git add terraform-s3-bucket/finaloutput/index.html
        git commit -m "Add generated HTML output"
        git push origin main
